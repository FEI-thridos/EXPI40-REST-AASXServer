#pragma checksum "C:\Users\martin.pajpach\Downloads\AASX REST Server\src\AasxServerBlazor\Pages\Pcf.razor" "{8829d00f-11b8-4213-878b-770e8597ac16}" "34c1b24496a5bbcde84b3f865219acfc397733b7deac37dc7c75ba0af4f1aaa3"
// <auto-generated/>
#pragma warning disable 1591
namespace AasxServerBlazor.Pages
{
    #line hidden
    using global::System;
    using global::System.Collections.Generic;
    using global::System.Linq;
    using global::System.Threading.Tasks;
    using global::Microsoft.AspNetCore.Components;
#nullable restore
#line 1 "C:\Users\martin.pajpach\Downloads\AASX REST Server\src\AasxServerBlazor\_Imports.razor"
using System.Net.Http;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "C:\Users\martin.pajpach\Downloads\AASX REST Server\src\AasxServerBlazor\_Imports.razor"
using Microsoft.AspNetCore.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "C:\Users\martin.pajpach\Downloads\AASX REST Server\src\AasxServerBlazor\_Imports.razor"
using Microsoft.AspNetCore.Components.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "C:\Users\martin.pajpach\Downloads\AASX REST Server\src\AasxServerBlazor\_Imports.razor"
using Microsoft.AspNetCore.Components.Forms;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "C:\Users\martin.pajpach\Downloads\AASX REST Server\src\AasxServerBlazor\_Imports.razor"
using Microsoft.AspNetCore.Components.Routing;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "C:\Users\martin.pajpach\Downloads\AASX REST Server\src\AasxServerBlazor\_Imports.razor"
using Microsoft.AspNetCore.Components.Web;

#line default
#line hidden
#nullable disable
#nullable restore
#line 7 "C:\Users\martin.pajpach\Downloads\AASX REST Server\src\AasxServerBlazor\_Imports.razor"
using Microsoft.JSInterop;

#line default
#line hidden
#nullable disable
#nullable restore
#line 8 "C:\Users\martin.pajpach\Downloads\AASX REST Server\src\AasxServerBlazor\_Imports.razor"
using AasxServerBlazor;

#line default
#line hidden
#nullable disable
#nullable restore
#line 9 "C:\Users\martin.pajpach\Downloads\AASX REST Server\src\AasxServerBlazor\_Imports.razor"
using AasxServerBlazor.Shared;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "C:\Users\martin.pajpach\Downloads\AASX REST Server\src\AasxServerBlazor\Pages\Pcf.razor"
using Data;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "C:\Users\martin.pajpach\Downloads\AASX REST Server\src\AasxServerBlazor\Pages\Pcf.razor"
using AasxServer;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "C:\Users\martin.pajpach\Downloads\AASX REST Server\src\AasxServerBlazor\Pages\Pcf.razor"
using static AdminShellNS.AdminShellV20;

#line default
#line hidden
#nullable disable
#nullable restore
#line 7 "C:\Users\martin.pajpach\Downloads\AASX REST Server\src\AasxServerBlazor\Pages\Pcf.razor"
using System.Drawing;

#line default
#line hidden
#nullable disable
#nullable restore
#line 8 "C:\Users\martin.pajpach\Downloads\AASX REST Server\src\AasxServerBlazor\Pages\Pcf.razor"
using System.Globalization;

#line default
#line hidden
#nullable disable
    [global::Microsoft.AspNetCore.Components.RouteAttribute("/pcf")]
    public partial class Pcf : global::Microsoft.AspNetCore.Components.ComponentBase, IDisposable
    {
        #pragma warning disable 1998
        protected override void BuildRenderTree(global::Microsoft.AspNetCore.Components.Rendering.RenderTreeBuilder __builder)
        {
#nullable restore
#line 11 "C:\Users\martin.pajpach\Downloads\AASX REST Server\src\AasxServerBlazor\Pages\Pcf.razor"
   
    DateTime timeStamp = DateTime.UtcNow;
    // AasxTask.cfpNode node = AasxTask.createCfpTree(0, timeStamp);
    // AasxTask.cfpNode node = AasxTask.root;
    float total = 0.0f;
    try
    {
        total = (float)Convert.ToDouble(AasxTask.root.cradleToGateCombination.value, CultureInfo.InvariantCulture);
        total = (float)Math.Round(total, 1);

    }
    catch { }

#line default
#line hidden
#nullable disable
            __builder.OpenElement(0, "div");
            __builder.AddAttribute(1, "class", "relative flex min-h-screen flex-col justify-center overflow-hidden bg-gray-50");
            __builder.AddMarkupContent(2, "\n    <img src=\"https://play.tailwindcss.com/img/beams.jpg\" alt class=\"absolute top-1/2 left-1/2 max-w-none -translate-x-1/2 -translate-y-1/2\" width=\"1308\">\n    ");
            __builder.OpenElement(3, "div");
            __builder.AddAttribute(4, "style", "background-color: #174a87; margin-left:1px; margin-top:2px;");
            __builder.AddAttribute(5, "class", "node w-full mb-2 relative px-6 pt-4 pb-2 shadow-xl ring-1 ring-gray-900/5 sm:mx-auto sm:rounded-lg sm:px-8");
            __builder.AddMarkupContent(6, "\n        ");
            __builder.OpenElement(7, "div");
            __builder.AddAttribute(8, "class", "node mb-2 flex flex-row space-x-2");
            __builder.AddMarkupContent(9, "\n            ");
            __builder.OpenElement(10, "div");
            __builder.AddAttribute(11, "class", "self-center grow");
            __builder.AddMarkupContent(12, "\n                ");
            __builder.OpenElement(13, "div");
            __builder.AddAttribute(14, "class", "font-bold text-slate-700 dark:text-slate-500 text-center");
            __builder.AddMarkupContent(15, "\n                    ");
            __builder.OpenElement(16, "font");
            __builder.AddMarkupContent(17, "\n                        ");
            __builder.OpenElement(18, "span");
            __builder.AddAttribute(19, "style", "color: white; font-size:250%;");
#nullable restore
#line 31 "C:\Users\martin.pajpach\Downloads\AASX REST Server\src\AasxServerBlazor\Pages\Pcf.razor"
__builder.AddContent(20, total);

#line default
#line hidden
#nullable disable
            __builder.CloseElement();
            __builder.AddMarkupContent(21, "\n                        ");
            __builder.AddMarkupContent(22, "<span style=\"color: #EFEFEF; font-size:130%\">\n                            kg CO<sub>2</sub>e\n                        </span>\n                    ");
            __builder.CloseElement();
            __builder.AddMarkupContent(23, "\n                ");
            __builder.CloseElement();
            __builder.AddMarkupContent(24, "\n            ");
            __builder.CloseElement();
            __builder.AddMarkupContent(25, "\n        ");
            __builder.CloseElement();
            __builder.AddMarkupContent(26, "\n    ");
            __builder.CloseElement();
            __builder.AddMarkupContent(27, "\n");
#nullable restore
#line 40 "C:\Users\martin.pajpach\Downloads\AASX REST Server\src\AasxServerBlazor\Pages\Pcf.razor"
      
        nextLevel(AasxTask.root, total, timeStamp);
    

#line default
#line hidden
#nullable disable
            __builder.CloseElement();
            __builder.AddMarkupContent(28, "\n\n");
#nullable restore
#line 45 "C:\Users\martin.pajpach\Downloads\AASX REST Server\src\AasxServerBlazor\Pages\Pcf.razor"
      
        void nextLevel(AasxTask.cfpNode nextNode, float total, DateTime timeStamp, bool moduleOnly = false)
        {

#line default
#line hidden
#nullable disable
            __builder.AddContent(29, "            ");
            __builder.OpenElement(30, "div");
            __builder.AddAttribute(31, "class", "node mb-2 relative bg-white px-6 pt-4 pb-2 shadow-xl ring-1 ring-gray-900/5 sm:mx-auto sm:rounded-lg sm:px-8");
            __builder.AddMarkupContent(32, "\n\n");
#nullable restore
#line 50 "C:\Users\martin.pajpach\Downloads\AASX REST Server\src\AasxServerBlazor\Pages\Pcf.razor"
                  
                    AasxTask.cfpNode node = nextNode;
                    while (node != null)
                    {
                        if (node.iChild == 0)
                        {

                            bool view = false;
                            bool viewCombination = false;
                            string value = "";
                            if (moduleOnly)
                            {
                                if (node.cradleToGateModule != null)
                                {
                                    value = node.cradleToGateModule.value;
                                    view = true;
                                }
                            }
                            else
                            {
                                if (node.children.Count != 0)
                                {
                                    if (node.cradleToGateCombination != null)
                                    {
                                        value = node.cradleToGateCombination.value;
                                        //if (node != AasxTask.root)
                                        viewCombination = true;
                                        view = true;
                                    }
                                }
                                else
                                {
                                    if (node.cradleToGateModule != null)
                                    {
                                        value = node.cradleToGateModule.value;
                                        view = true;
                                    }
                                }
                            }
                            float actual = 0.0f;
                            try
                            {
                                actual = (float)Convert.ToDouble(value, CultureInfo.InvariantCulture);
                            }
                            catch { }

                            if (view)
                            {
                                string productImage = getImage(node.productImage, node.envIndex);
                                string manufacturerLogo = getImage(node.manufacturerLogo, node.envIndex);
                                float p = actual / total * 100;
                                if (p < 1)
                                    p = 1;
                                string percent = "0";
                                try
                                {
                                    percent = Convert.ToInt32(p).ToString();
                                }
                                catch { }
                                value = Math.Round(actual, 3).ToString(CultureInfo.InvariantCulture);

                                //hide all pcf values except for root
                                var hideClass = "hidden";
                                var hideCircle = hideClass; //always hide circle
                                var hideElement = hideClass; //decide hiding of elements



#line default
#line hidden
#nullable disable
            __builder.AddContent(33, "                                ");
            __builder.OpenElement(34, "div");
            __builder.AddAttribute(35, "class", "node mb-2 flex flex-row space-x-2");
            __builder.AddMarkupContent(36, "\n\n                                    ");
            __builder.OpenElement(37, "div");
            __builder.AddAttribute(38, "class", "grid" + " place-items-center" + " self-center" + " " + (
#nullable restore
#line 119 "C:\Users\martin.pajpach\Downloads\AASX REST Server\src\AasxServerBlazor\Pages\Pcf.razor"
                                                                                     hideElement

#line default
#line hidden
#nullable disable
            ));
            __builder.AddMarkupContent(39, "\n                                        ");
            __builder.OpenElement(40, "div");
            __builder.AddAttribute(41, "class", "w-10" + " mx-auto" + " " + (
#nullable restore
#line 120 "C:\Users\martin.pajpach\Downloads\AASX REST Server\src\AasxServerBlazor\Pages\Pcf.razor"
                                                                  hideCircle

#line default
#line hidden
#nullable disable
            ));
            __builder.AddMarkupContent(42, "\n                                            ");
            __builder.OpenElement(43, "svg");
            __builder.AddAttribute(44, "height", "35");
            __builder.AddAttribute(45, "width", "35");
            __builder.AddAttribute(46, "viewBox", "0 0 20 20");
            __builder.AddMarkupContent(47, "\n                                                ");
            __builder.OpenElement(48, "circle");
            __builder.AddAttribute(49, "r", "5");
            __builder.AddAttribute(50, "cx", "10");
            __builder.AddAttribute(51, "cy", "10");
            __builder.AddAttribute(52, "fill", "white");
            __builder.AddAttribute(53, "stroke", "#174a87");
            __builder.AddAttribute(54, "stroke-width", "10");
            __builder.AddAttribute(55, "stroke-dasharray", "calc(" + (
#nullable restore
#line 125 "C:\Users\martin.pajpach\Downloads\AASX REST Server\src\AasxServerBlazor\Pages\Pcf.razor"
                                                                                percent

#line default
#line hidden
#nullable disable
            ) + " *" + " 31.42px" + " /" + " 100)" + " 31.42");
            __builder.AddAttribute(56, "transform", "rotate(-90) translate(-20)");
            __builder.CloseElement();
            __builder.AddMarkupContent(57, "\n                                                <circle r=\"9.5\" cx=\"10\" cy=\"10\" fill=\"white\" stroke-width=\"0.5\" fill-opacity=\"0\" stroke=\"#174a87\" transform=\"rotate(-90) translate(-20)\"></circle>\n                                            ");
            __builder.CloseElement();
            __builder.AddMarkupContent(58, "\n                                        ");
            __builder.CloseElement();
            __builder.AddMarkupContent(59, "\n                                        ");
            __builder.OpenElement(60, "div");
            __builder.AddAttribute(61, "class", "self-center" + " text-center" + " " + (
#nullable restore
#line 134 "C:\Users\martin.pajpach\Downloads\AASX REST Server\src\AasxServerBlazor\Pages\Pcf.razor"
                                                                             hideElement

#line default
#line hidden
#nullable disable
            ));
            __builder.AddMarkupContent(62, "\n");
#nullable restore
#line 135 "C:\Users\martin.pajpach\Downloads\AASX REST Server\src\AasxServerBlazor\Pages\Pcf.razor"
                                              
                                                //if (node == AasxTask.root)
                                                //{
                                                //    <font size="+2"><span style="color:#174a87">@value</span></font>
                                                //}
                                                //else
                                                //{

#line default
#line hidden
#nullable disable
            __builder.AddContent(63, "                                                ");
            __builder.OpenElement(64, "span");
            __builder.AddAttribute(65, "style", "color:#174a87");
#nullable restore
#line 142 "C:\Users\martin.pajpach\Downloads\AASX REST Server\src\AasxServerBlazor\Pages\Pcf.razor"
__builder.AddContent(66, value);

#line default
#line hidden
#nullable disable
            __builder.CloseElement();
            __builder.AddMarkupContent(67, "\n");
#nullable restore
#line 143 "C:\Users\martin.pajpach\Downloads\AASX REST Server\src\AasxServerBlazor\Pages\Pcf.razor"
                                                //}
                                            

#line default
#line hidden
#nullable disable
            __builder.AddContent(68, "                                        ");
            __builder.CloseElement();
            __builder.AddMarkupContent(69, "\n                                    ");
            __builder.CloseElement();
            __builder.AddMarkupContent(70, "\n");
#nullable restore
#line 147 "C:\Users\martin.pajpach\Downloads\AASX REST Server\src\AasxServerBlazor\Pages\Pcf.razor"
                                     if (!viewCombination && productImage != null)
                                    {
                                        var bytes = Convert.FromBase64String(productImage);
                                        using (var stream = new System.IO.MemoryStream(bytes))
                                        {
                                            using (System.Drawing.Image img = System.Drawing.Image.FromStream(stream))
                                            {
                                                double idealArea = 2000;
                                                var maxWidth = Math.Round(img.Width * Math.Sqrt(idealArea / ((double)img.Width * (double)img.Height)));
                                                var maxWidthPx = maxWidth + "px";

                                                // <img src=data:image;base64,@productImage class="h-16" style="max-width: @maxWidthPx; object-fit: contain;" />
                                                productImage = getImageLink(node.productImage, node.envIndex);
                                                if (productImage != null)
                                                {

#line default
#line hidden
#nullable disable
            __builder.AddContent(71, "                                                    ");
            __builder.OpenElement(72, "img");
            __builder.AddAttribute(73, "src", 
#nullable restore
#line 162 "C:\Users\martin.pajpach\Downloads\AASX REST Server\src\AasxServerBlazor\Pages\Pcf.razor"
                                                              productImage

#line default
#line hidden
#nullable disable
            );
            __builder.AddAttribute(74, "class", "h-16");
            __builder.AddAttribute(75, "style", "max-width:" + " " + (
#nullable restore
#line 162 "C:\Users\martin.pajpach\Downloads\AASX REST Server\src\AasxServerBlazor\Pages\Pcf.razor"
                                                                                                           maxWidthPx

#line default
#line hidden
#nullable disable
            ) + ";" + " object-fit:" + " contain;");
            __builder.CloseElement();
            __builder.AddMarkupContent(76, "\n");
#nullable restore
#line 163 "C:\Users\martin.pajpach\Downloads\AASX REST Server\src\AasxServerBlazor\Pages\Pcf.razor"
                                                }
                                            }
                                        }
                                    }

#line default
#line hidden
#nullable disable
#nullable restore
#line 167 "C:\Users\martin.pajpach\Downloads\AASX REST Server\src\AasxServerBlazor\Pages\Pcf.razor"
                                     if (manufacturerLogo != null)
                                    {
                                        var bytes = Convert.FromBase64String(manufacturerLogo);
                                        using (var stream = new System.IO.MemoryStream(bytes))
                                        {
                                            using (System.Drawing.Image img = System.Drawing.Image.FromStream(stream))
                                            {
                                                double idealArea = 1800;
                                                var maxWidth = Math.Round(img.Width * Math.Sqrt(idealArea / ((double)img.Width * (double)img.Height)));
                                                var maxWidthPx = maxWidth + "px";

                                                // <img src=data:image;base64,@manufacturerLogo style="max-width: @maxWidthPx; object-fit: contain;" class="self-center" />
                                                manufacturerLogo = getImageLink(node.manufacturerLogo, node.envIndex);
                                                if (manufacturerLogo != null)
                                                {

#line default
#line hidden
#nullable disable
            __builder.AddContent(77, "                                                    ");
            __builder.OpenElement(78, "img");
            __builder.AddAttribute(79, "src", 
#nullable restore
#line 182 "C:\Users\martin.pajpach\Downloads\AASX REST Server\src\AasxServerBlazor\Pages\Pcf.razor"
                                                              manufacturerLogo

#line default
#line hidden
#nullable disable
            );
            __builder.AddAttribute(80, "style", "max-width:" + " " + (
#nullable restore
#line 182 "C:\Users\martin.pajpach\Downloads\AASX REST Server\src\AasxServerBlazor\Pages\Pcf.razor"
                                                                                                  maxWidthPx

#line default
#line hidden
#nullable disable
            ) + ";" + " object-fit:" + " contain;");
            __builder.AddAttribute(81, "class", "self-center");
            __builder.CloseElement();
            __builder.AddMarkupContent(82, "\n");
#nullable restore
#line 183 "C:\Users\martin.pajpach\Downloads\AASX REST Server\src\AasxServerBlazor\Pages\Pcf.razor"
                                                }
                                            }
                                        }
                                    }

#line default
#line hidden
#nullable disable
#nullable restore
#line 187 "C:\Users\martin.pajpach\Downloads\AASX REST Server\src\AasxServerBlazor\Pages\Pcf.razor"
                                      
                                        string text = node.productDesignation;
                                        if (viewCombination)
                                        {
                                            text = "Combination - " + text;
                                        }

#line default
#line hidden
#nullable disable
            __builder.AddContent(83, "                                        ");
            __builder.OpenElement(84, "div");
            __builder.AddAttribute(85, "class", "self-center grow");
            __builder.AddMarkupContent(86, "\n                                            ");
            __builder.OpenElement(87, "div");
            __builder.AddAttribute(88, "class", "font-bold text-slate-700 dark:text-slate-500");
#nullable restore
#line 194 "C:\Users\martin.pajpach\Downloads\AASX REST Server\src\AasxServerBlazor\Pages\Pcf.razor"
__builder.AddContent(89, text);

#line default
#line hidden
#nullable disable
            __builder.CloseElement();
            __builder.AddMarkupContent(90, "\n                                        ");
            __builder.CloseElement();
            __builder.AddMarkupContent(91, "\n");
            __builder.AddContent(92, "                                    ");
            __builder.OpenElement(93, "div");
            __builder.AddAttribute(94, "class", "flex-none self-center hide-slim");
            __builder.AddMarkupContent(95, "\n                                        ");
            __builder.OpenElement(96, "button");
            __builder.AddAttribute(97, "class", "btn px-3 text-white");
            __builder.AddAttribute(98, "onclick", "document.getElementById(\'iframe\').src=\'/dashboard/submodelView.html?id=" + (
#nullable restore
#line 199 "C:\Users\martin.pajpach\Downloads\AASX REST Server\src\AasxServerBlazor\Pages\Pcf.razor"
                                                                                                                                 node.aas.idShort

#line default
#line hidden
#nullable disable
            ) + "\'");
            __builder.AddAttribute(99, "style", "background-color: #174a87; padding: 0.1rem 0.4rem 0.1rem 0.4rem !important;");
            __builder.AddMarkupContent(100, "\n                                            <i class=\"fas fa-arrow-right\" aria-hidden=\"true\"></i>\n                                        ");
            __builder.CloseElement();
            __builder.AddMarkupContent(101, "\n                                    ");
            __builder.CloseElement();
            __builder.AddMarkupContent(102, "\n                                ");
            __builder.CloseElement();
            __builder.AddMarkupContent(103, "\n");
#nullable restore
#line 205 "C:\Users\martin.pajpach\Downloads\AASX REST Server\src\AasxServerBlazor\Pages\Pcf.razor"
                                if (!moduleOnly && node.children.Count != 0 && node.cradleToGateModule != null)
                                {
                                    nextLevel(node, total, timeStamp, true);
                                }
                            }
                        }

                        // move up, if all children iterated
                        if (moduleOnly || node.iChild == node.children.Count)
                        {
                            node.iChild = 0;
                            node = null;
                        }
                        else
                        {
                            // Interate children
                            nextLevel(node.children[node.iChild], total, timeStamp);
                            node.iChild++;
                        }
                    }
                

#line default
#line hidden
#nullable disable
            __builder.AddMarkupContent(104, "\n            ");
            __builder.CloseElement();
            __builder.AddMarkupContent(105, "\n");
#nullable restore
#line 228 "C:\Users\martin.pajpach\Downloads\AASX REST Server\src\AasxServerBlazor\Pages\Pcf.razor"
        }

        string getImageLink(File f, int envIndex)
        {
            if (f == null || envIndex == -1)
                return null;

            if (f.value != "")
            {
                string[] split = f.value.Split(new Char[] { '/' });
                if (split.Length == 2 || split.Length > 1 && split[1].ToLower() == "aasx")
                {
                    split = f.value.Split(new Char[] { '.' });
                    switch (split.Last().ToLower())
                    {
                        case "jpg":
                        case "bmp":
                        case "png":
                            try
                            {
                                return Program.externalRest + "/server/getfile/" + envIndex + f.value;
                            }
                            catch { }
                            break;
                    }
                }
            }
            return null;
        }

        string getImage(File f, int envIndex)
        {
            if (f == null || envIndex == -1)
                return null;

            if (f.value != "")
            {
                string[] split = f.value.Split(new Char[] { '/' });
                if (split.Length == 2 || split.Length > 1 && split[1].ToLower() == "aasx")
                {
                    split = f.value.Split(new Char[] { '.' });
                    switch (split.Last().ToLower())
                    {
                        case "jpg":
                        case "bmp":
                        case "png":
                            try
                            {
                                using (System.IO.Stream s = Program.env[envIndex].GetLocalStreamFromPackage(f.value))
                                {
                                    if (s != null)
                                    {
                                        using (var m = new System.IO.MemoryStream())
                                        {
                                            s.CopyTo(m);
                                            return System.Convert.ToBase64String(m.ToArray());
                                        }
                                    }
                                }
                            }
                            catch { }
                            break;
                    }
                }
            }
            return null;
        }
    

#line default
#line hidden
#nullable disable
        }
        #pragma warning restore 1998
#nullable restore
#line 297 "C:\Users\martin.pajpach\Downloads\AASX REST Server\src\AasxServerBlazor\Pages\Pcf.razor"
           
        protected override void OnInitialized()
        {
            SubmodelService.NewDataAvailable += NewData;
        }

        public void Dispose()
        {
            SubmodelService.NewDataAvailable -= NewData;
        }

        void NewData(object source, EventArgs args)
        {
            if (Program.isLoading)
                return;

            if (args is Program.NewDataAvailableArgs newArgs)
            {
                int newDataMode = newArgs.signalNewDataMode;
                if (newDataMode != 0)
                {
                    InvokeAsync(() => this.StateHasChanged());
                }
            }
        }
    

#line default
#line hidden
#nullable disable
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private AASService SubmodelService { get; set; }
    }
}
#pragma warning restore 1591
